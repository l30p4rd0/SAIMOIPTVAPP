import{n as e}from"./rolldown-runtime-DF2fYuay.js";import{i as t,r as n}from"./catalog-D3FyGHSq.js";import{n as r,s as i}from"./player-DECz-FPx.js";var a=e(r(),1),o=e(t(),1),s=e(n(),1);function c({initialUrl:e=``}){let t=(0,o.useRef)(null),n=(0,o.useRef)(null),r=(0,o.useRef)(null),c=(0,o.useRef)(null),l=(0,o.useRef)(null),u=(0,o.useRef)(null),d=(0,o.useRef)(null),f=(0,o.useRef)(!1),[p,m]=(0,o.useState)(e),[h,g]=(0,o.useState)(!1),[_,v]=(0,o.useState)(!0),[y,b]=(0,o.useState)(15),[x,S]=(0,o.useState)(0),[C,w]=(0,o.useState)(null),[T,E]=(0,o.useState)(!1),[D,O]=(0,o.useState)([]),[k,A]=(0,o.useState)(`main`),[j,M]=(0,o.useState)({refreshCount:0,playTime:0,lastRefresh:null}),N=(0,o.useCallback)(e=>{let t=new Date().toLocaleTimeString(`pt-BR`);O(n=>[`[${t}] ${e}`,...n.slice(0,99)])},[]),P=(0,o.useCallback)(()=>{r.current&&=(r.current.destroy(),null),c.current&&=(c.current.destroy(),null),l.current&&=(l.current.destroy(),null)},[]),F=(0,o.useCallback)((e,t,n,r)=>{if(!i.isSupported())return null;let a=new i({enableWorker:!0,lowLatencyMode:!0,backBufferLength:30,maxBufferLength:15,maxMaxBufferLength:30,liveSyncDurationCount:3,liveMaxLatencyDurationCount:5});return a.loadSource(t),a.attachMedia(e),a.on(i.Events.MANIFEST_PARSED,()=>{n()}),a.on(i.Events.ERROR,(e,t)=>{t.fatal&&(t.type===i.ErrorTypes.NETWORK_ERROR?a.startLoad():t.type===i.ErrorTypes.MEDIA_ERROR?a.recoverMediaError():r(t.details))}),a},[]),I=(0,o.useCallback)((e,n=!0)=>{if(!e.trim()||!t.current)return;let o=t.current;n&&(E(!0),w(null),N(`Carregando stream: ${e}`),P());let s=e.endsWith(`.mp4`),c=e=>{e.play().then(()=>{g(!0),N(`â–¶ï¸ ReproduÃ§Ã£o iniciada`)}).catch(()=>{e.muted=!0,e.play().then(()=>{g(!0),N(`â–¶ï¸ ReproduÃ§Ã£o iniciada (muted)`)}).catch(e=>{let t=e instanceof Error?e.message:String(e);w(`Erro ao iniciar reproduÃ§Ã£o`),N(`âŒ Erro ao iniciar reproduÃ§Ã£o: ${t}`)})})};if(s)N(`Detectado formato MP4.`),o.src=e,o.addEventListener(`loadedmetadata`,()=>{E(!1),N(`âœ… Metadados do MP4 carregados.`),c(o)}),o.addEventListener(`error`,()=>{E(!1),w(`Erro ao carregar vÃ­deo MP4.`),N(`âŒ Erro ao carregar vÃ­deo MP4.`)}),o.load();else if(e.endsWith(`.ts`)||e.includes(`.ts?`))if(a.default.isSupported()){N(`Detectado formato MPEG-TS. Iniciando mpegts.js...`);try{let t=a.default.createPlayer({type:`mpegts`,isLive:!0,url:e,cors:!0},{enableWorker:!0,lazyLoadMaxDuration:180,seekType:`range`});t.attachMediaElement(o),t.load(),t.on(a.default.Events.ERROR,(e,t)=>{e===a.default.ErrorTypes.NETWORK_ERROR?(N(`âŒ Erro de Rede mpegts: ${t}`),w(`Erro de Rede: ${t}`)):(N(`âŒ Erro mpegts: ${e} - ${t}`),w(`Erro mpegts: ${t}`)),E(!1)}),t.on(a.default.Events.LOADING_COMPLETE,()=>{N(`âœ… Carregamento mpegts completo`),E(!1)}),o.addEventListener(`canplay`,()=>{E(!1),c(o)},{once:!0}),l.current=t,c(o)}catch(e){N(`âŒ ExceÃ§Ã£o ao criar mpegts player: ${e}`),w(`Falha ao iniciar mpegts.js`),E(!1)}}else N(`âŒ mpegts.js nÃ£o suportado neste navegador.`),w(`Browser nÃ£o suporta mpegts.js`),E(!1);else if(i.isSupported()){N(`Detectado formato HLS (M3U8).`);let t=F(o,e,()=>{E(!1),N(`âœ… Manifest HLS carregado com sucesso`),c(o)},e=>{w(`Erro HLS: ${e}`),E(!1),N(`âŒ Erro fatal HLS: ${e}`)});t&&(r.current=t)}else o.canPlayType(`application/vnd.apple.mpegurl`)?(N(`Detectado suporte nativo a HLS (Safari).`),o.src=e,o.addEventListener(`loadedmetadata`,()=>{E(!1),N(`âœ… Stream carregado (Safari nativo)`),c(o)})):(w(`Navegador nÃ£o suporta HLS`),N(`âŒ Navegador nÃ£o suporta HLS`),E(!1))},[F,P,N]),L=(0,o.useCallback)(()=>{if(!p.trim()||!n.current||!t.current||f.current)return;if(p.endsWith(`.mp4`)){N(`â„¹ï¸ Auto-refresh nÃ£o aplicÃ¡vel para vÃ­deos MP4.`);return}f.current=!0;let e=k===`main`?t.current:n.current,i=k===`main`?n.current:t.current;N(`ðŸ”„ Iniciando refresh invisÃ­vel em background...`),k===`main`&&c.current?(c.current.destroy(),c.current=null):k===`backup`&&r.current&&(r.current.destroy(),r.current=null);let a=F(i,p,()=>{N(`âœ… Stream de backup pronto`),i.volume=e.volume,i.muted=e.muted,i.play().then(()=>{setTimeout(()=>{i.style.opacity=`1`,i.style.zIndex=`2`,e.style.opacity=`0`,e.style.zIndex=`1`,A(e=>e===`main`?`backup`:`main`),k===`main`?c.current=a:r.current=a,M(e=>({...e,refreshCount:e.refreshCount+1,lastRefresh:new Date})),N(`âœ¨ Troca invisÃ­vel concluÃ­da!`),f.current=!1,setTimeout(()=>{e.pause()},500)},300)}).catch(()=>{i.muted=!0,i.play().then(()=>{setTimeout(()=>{i.style.opacity=`1`,i.style.zIndex=`2`,e.style.opacity=`0`,e.style.zIndex=`1`,A(e=>e===`main`?`backup`:`main`),k===`main`?c.current=a:r.current=a,M(e=>({...e,refreshCount:e.refreshCount+1,lastRefresh:new Date})),N(`âœ¨ Troca invisÃ­vel concluÃ­da! (muted)`),f.current=!1,setTimeout(()=>{e.pause()},500)},300)}).catch(e=>{N(`âŒ Erro no refresh invisÃ­vel: ${e instanceof Error?e.message:String(e)}`),f.current=!1})})},e=>{N(`âŒ Erro no refresh de backup: ${e}`),f.current=!1});S(y)},[p,y,k,F,N]),R=(0,o.useCallback)(()=>{p.trim()&&L()},[p,L]);return(0,o.useEffect)(()=>{let e=p.endsWith(`.mp4`);return h&&_&&y>0&&!e&&(S(y),d.current=setInterval(()=>{S(e=>e<=1?y:e-1)},1e3),u.current=setInterval(()=>{R()},y*1e3)),()=>{u.current&&=(clearInterval(u.current),null),d.current&&=(clearInterval(d.current),null)}},[h,_,y,R,p]),(0,o.useEffect)(()=>{let e=null;return h&&(e=setInterval(()=>{M(e=>({...e,playTime:e.playTime+1}))},1e3)),()=>{e&&clearInterval(e)}},[h]),(0,o.useEffect)(()=>()=>{P()},[P]),(0,s.jsxs)(`div`,{className:`stream-tester`,children:[(0,s.jsxs)(`header`,{className:`stream-tester-header`,children:[(0,s.jsx)(`h1`,{children:`ðŸ”§ Stream Tester`}),(0,s.jsx)(`p`,{children:`Teste streams HLS (.m3u8) com auto-refresh ou vÃ­deos MP4 diretos.`})]}),(0,s.jsxs)(`form`,{className:`stream-tester-form`,onSubmit:e=>{e.preventDefault(),p.trim()&&(M({refreshCount:0,playTime:0,lastRefresh:null}),O([]),I(p))},children:[(0,s.jsxs)(`div`,{className:`input-group`,children:[(0,s.jsx)(`label`,{htmlFor:`stream-url`,children:`URL do Stream (M3U8 ou MP4)`}),(0,s.jsx)(`input`,{id:`stream-url`,type:`url`,value:p,onChange:e=>m(e.target.value),placeholder:`http://example.com/stream.m3u8 ou video.mp4`,className:`stream-url-input`})]}),(0,s.jsxs)(`div`,{className:`settings-row`,children:[(0,s.jsx)(`div`,{className:`setting-item`,children:(0,s.jsxs)(`label`,{htmlFor:`auto-refresh`,children:[(0,s.jsx)(`input`,{id:`auto-refresh`,type:`checkbox`,checked:_,onChange:e=>v(e.target.checked),disabled:p.endsWith(`.mp4`)}),`Auto-refresh (apenas HLS)`]})}),(0,s.jsxs)(`div`,{className:`setting-item`,children:[(0,s.jsx)(`label`,{htmlFor:`refresh-interval`,children:`Intervalo (segundos)`}),(0,s.jsx)(`input`,{id:`refresh-interval`,type:`number`,min:`5`,max:`60`,value:y,onChange:e=>b(Number(e.target.value)),className:`interval-input`,disabled:p.endsWith(`.mp4`)})]})]}),(0,s.jsxs)(`div`,{className:`button-row`,children:[(0,s.jsx)(`button`,{type:`submit`,className:`btn btn-primary`,disabled:!p.trim(),children:`â–¶ï¸ Iniciar`}),(0,s.jsx)(`button`,{type:`button`,className:`btn btn-secondary`,onClick:()=>{P(),t.current&&(t.current.src=``,t.current.style.opacity=`1`,t.current.style.zIndex=`2`),n.current&&(n.current.src=``,n.current.style.opacity=`0`,n.current.style.zIndex=`1`),A(`main`),g(!1),N(`â¹ï¸ Stream parado`)},disabled:!h,children:`â¹ï¸ Parar`}),(0,s.jsx)(`button`,{type:`button`,className:`btn btn-secondary`,onClick:R,disabled:!p.trim()||p.endsWith(`.mp4`),children:`ðŸ”„ Reiniciar Agora`})]})]}),(0,s.jsxs)(`div`,{className:`stream-tester-content`,children:[(0,s.jsxs)(`div`,{className:`player-section`,children:[(0,s.jsxs)(`div`,{className:`video-container`,children:[T&&(0,s.jsxs)(`div`,{className:`loading-overlay`,children:[(0,s.jsx)(`div`,{className:`spinner`}),(0,s.jsx)(`span`,{children:`Carregando...`})]}),C&&(0,s.jsx)(`div`,{className:`error-overlay`,children:(0,s.jsxs)(`span`,{children:[`âŒ `,C]})}),(0,s.jsx)(`video`,{ref:t,className:`video-player video-main`,playsInline:!0,controls:!0,style:{opacity:k===`main`?1:0,zIndex:k===`main`?2:1}}),(0,s.jsx)(`video`,{ref:n,className:`video-player video-backup`,playsInline:!0,controls:!0,style:{opacity:k===`backup`?1:0,zIndex:k===`backup`?2:1}}),h&&_&&!p.endsWith(`.mp4`)&&(0,s.jsxs)(`div`,{className:`refresh-indicator seamless`,children:[`âœ¨ Refresh invisÃ­vel em: `,(0,s.jsxs)(`strong`,{children:[x,`s`]})]})]}),(0,s.jsxs)(`div`,{className:`stats-panel`,children:[(0,s.jsx)(`h3`,{children:`ðŸ“Š EstatÃ­sticas`}),(0,s.jsxs)(`div`,{className:`stats-grid`,children:[(0,s.jsxs)(`div`,{className:`stat-item`,children:[(0,s.jsx)(`span`,{className:`stat-label`,children:`Status`}),(0,s.jsx)(`span`,{className:`stat-value ${h?`playing`:`stopped`}`,children:h?`â–¶ï¸ Reproduzindo`:`â¹ï¸ Parado`})]}),(0,s.jsxs)(`div`,{className:`stat-item`,children:[(0,s.jsx)(`span`,{className:`stat-label`,children:`Tempo de reproduÃ§Ã£o`}),(0,s.jsx)(`span`,{className:`stat-value`,children:(e=>{let t=Math.floor(e/3600),n=Math.floor(e%3600/60),r=e%60;return t>0?`${t}h ${n}m ${r}s`:n>0?`${n}m ${r}s`:`${r}s`})(j.playTime)})]}),(0,s.jsxs)(`div`,{className:`stat-item`,children:[(0,s.jsx)(`span`,{className:`stat-label`,children:`Refreshes realizados`}),(0,s.jsx)(`span`,{className:`stat-value`,children:j.refreshCount})]}),(0,s.jsxs)(`div`,{className:`stat-item`,children:[(0,s.jsx)(`span`,{className:`stat-label`,children:`Ãšltimo refresh`}),(0,s.jsx)(`span`,{className:`stat-value`,children:j.lastRefresh?j.lastRefresh.toLocaleTimeString(`pt-BR`):`-`})]})]})]})]}),(0,s.jsxs)(`div`,{className:`logs-section`,children:[(0,s.jsx)(`h3`,{children:`ðŸ“ Logs`}),(0,s.jsx)(`div`,{className:`logs-container`,children:D.length===0?(0,s.jsx)(`p`,{className:`no-logs`,children:`Nenhum log ainda. Inicie um stream para ver os logs.`}):D.map((e,t)=>(0,s.jsx)(`div`,{className:`log-entry`,children:e},t))})]})]})]})}var l=c;export{c as StreamTester,l as default};